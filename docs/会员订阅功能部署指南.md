# ä¼šå‘˜è®¢é˜…åŠŸèƒ½éƒ¨ç½²æŒ‡å—

## ğŸ“¦ éƒ¨ç½²å‰å‡†å¤‡

### 1. ç¡®è®¤ç¯å¢ƒè¦æ±‚

- Node.js 18+
- æ•°æ®åº“ï¼šæ”¯æŒ D1ã€Redisã€Upstash Redis æˆ– KVRocks
- å·²å®‰è£… pnpm

### 2. æ£€æŸ¥å·²æœ‰æ–‡ä»¶

ç¡®è®¤ä»¥ä¸‹æ–‡ä»¶å·²æ­£ç¡®åˆ›å»ºï¼š

**æ•°æ®åº“è¡¨ç»“æ„ï¼š**
```
database/
â”œâ”€â”€ subscription_plans.sql
â”œâ”€â”€ user_subscriptions.sql
â”œâ”€â”€ payment_orders.sql
â””â”€â”€ payment_settings.sql
```

**å‰ç«¯ç»„ä»¶ï¼š**
```
src/components/admin/
â”œâ”€â”€ MembershipManagement.tsx
â”œâ”€â”€ SubscriptionPlansManager.tsx
â”œâ”€â”€ OrderManager.tsx
â””â”€â”€ PaymentSettingsForm.tsx
```

**APIè·¯ç”±ï¼š**
```
src/app/api/admin/
â”œâ”€â”€ plans/route.ts
â”œâ”€â”€ orders/route.ts
â””â”€â”€ payment-settings/route.ts
```

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1ï¼šåˆ›å»ºæ•°æ®åº“è¡¨

æ ¹æ®æ‚¨ä½¿ç”¨çš„å­˜å‚¨ç±»å‹æ‰§è¡Œç›¸åº”çš„SQLï¼š

#### D1 æ•°æ®åº“ï¼ˆCloudflareï¼‰

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /Volumes/OS/Users/wangbengang/Documents/moontv/MoonTV

# æ‰§è¡ŒSQLæ–‡ä»¶åˆ›å»ºè¡¨
wrangler d1 execute DB --file=./database/subscription_plans.sql
wrangler d1 execute DB --file=./database/user_subscriptions.sql
wrangler d1 execute DB --file=./database/payment_orders.sql
wrangler d1 execute DB --file=./database/payment_settings.sql
```

**æˆ–è€…ä½¿ç”¨Cloudflare Dashboardï¼š**
1. ç™»å½• Cloudflare Dashboard
2. è¿›å…¥ Workers & Pages â†’ D1
3. é€‰æ‹©æ‚¨çš„æ•°æ®åº“
4. åœ¨ Console æ ‡ç­¾é¡µä¸­ä¾æ¬¡æ‰§è¡Œ4ä¸ªSQLæ–‡ä»¶çš„å†…å®¹

#### MySQL/PostgreSQL

ç›´æ¥ä½¿ç”¨æ•°æ®åº“å®¢æˆ·ç«¯å·¥å…·ï¼ˆå¦‚ Navicatã€DBeaverï¼‰æ‰§è¡ŒSQLæ–‡ä»¶ã€‚

#### Redis/Upstash/KVRocks

è¿™äº›å­˜å‚¨ç±»å‹ä¸éœ€è¦é¢„å…ˆåˆ›å»ºè¡¨ï¼Œæ•°æ®ç»“æ„ä¼šåœ¨ä½¿ç”¨æ—¶è‡ªåŠ¨åˆ›å»ºã€‚

### æ­¥éª¤2ï¼šå®‰è£…ä¾èµ–ï¼ˆå¦‚æœ‰æ–°å¢ï¼‰

```bash
cd /Volumes/OS/Users/wangbengang/Documents/moontv/MoonTV
pnpm install
```

### æ­¥éª¤3ï¼šæœ¬åœ°æµ‹è¯•

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev

# è®¿é—®ç®¡ç†åå°
# æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:3000/admin
# ç™»å½•åå°ï¼ŒæŸ¥çœ‹"ä¼šå‘˜è®¢é˜…ç®¡ç†"æ ‡ç­¾
```

**æµ‹è¯•æ¸…å•ï¼š**
- âœ… èƒ½å¦æ‰“å¼€åå°ç®¡ç†é¡µé¢
- âœ… èƒ½å¦çœ‹åˆ°"ä¼šå‘˜è®¢é˜…ç®¡ç†"æ ‡ç­¾
- âœ… èƒ½å¦åˆ›å»ºå¥—é¤
- âœ… æ”¯ä»˜è®¾ç½®èƒ½å¦ä¿å­˜
- âœ… è®¢å•åˆ—è¡¨èƒ½å¦æ­£å¸¸æ˜¾ç¤º

### æ­¥éª¤4ï¼šæ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
# æ„å»ºé¡¹ç›®
pnpm build

# æ£€æŸ¥æ„å»ºæ˜¯å¦æˆåŠŸ
# æ„å»ºäº§ç‰©åœ¨ .next ç›®å½•
```

### æ­¥éª¤5ï¼šéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

æ ¹æ®æ‚¨çš„éƒ¨ç½²å¹³å°é€‰æ‹©ï¼š

#### æ–¹æ¡ˆAï¼šéƒ¨ç½²åˆ° Cloudflare Pages

```bash
# 1. å®‰è£… Cloudflare Pages æ’ä»¶
pnpm add -D @cloudflare/next-on-pages

# 2. æ„å»º Pages ç‰ˆæœ¬
pnpm run pages:build

# 3. éƒ¨ç½²ï¼ˆé¦–æ¬¡éœ€è¦ç™»å½•ï¼‰
npx wrangler pages deploy .vercel/output/static

# æˆ–ä½¿ç”¨ Cloudflare Dashboard æ‰‹åŠ¨ä¸Šä¼ 
```

**é…ç½®ç¯å¢ƒå˜é‡ï¼ˆåœ¨ Cloudflare Dashboard ä¸­ï¼‰ï¼š**
- `NEXT_PUBLIC_STORAGE_TYPE=d1` ï¼ˆæˆ–å…¶ä»–å­˜å‚¨ç±»å‹ï¼‰
- å…¶ä»–å¿…è¦çš„ç¯å¢ƒå˜é‡

#### æ–¹æ¡ˆBï¼šéƒ¨ç½²åˆ° Vercel

```bash
# 1. å®‰è£… Vercel CLI
npm i -g vercel

# 2. ç™»å½• Vercel
vercel login

# 3. éƒ¨ç½²
vercel --prod
```

**é…ç½®ç¯å¢ƒå˜é‡ï¼ˆåœ¨ Vercel Dashboard ä¸­ï¼‰ï¼š**
- `NEXT_PUBLIC_STORAGE_TYPE` - å­˜å‚¨ç±»å‹
- æ•°æ®åº“è¿æ¥ä¿¡æ¯ç­‰

#### æ–¹æ¡ˆCï¼šéƒ¨ç½²åˆ°è‡ªå·±çš„æœåŠ¡å™¨

```bash
# 1. æ„å»ºé¡¹ç›®
pnpm build

# 2. å¤åˆ¶ä»¥ä¸‹æ–‡ä»¶åˆ°æœåŠ¡å™¨
- .next/
- public/
- package.json
- next.config.js

# 3. åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…ä¾èµ–
pnpm install --prod

# 4. å¯åŠ¨æœåŠ¡
pnpm start

# 5. ä½¿ç”¨ PM2 ä¿æŒè¿è¡Œï¼ˆæ¨èï¼‰
pm2 start npm --name "moontv" -- start
pm2 save
pm2 startup
```

**Nginx é…ç½®ç¤ºä¾‹ï¼š**
```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

## ğŸ”§ éƒ¨ç½²åé…ç½®

### 1. é…ç½®æ”¯ä»˜è®¾ç½®

1. ç™»å½•åå°ç®¡ç†é¡µé¢
2. è¿›å…¥"ä¼šå‘˜è®¢é˜…ç®¡ç†" â†’ "æ”¯ä»˜è®¾ç½®"
3. å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š
   - æ”¯ä»˜å®æ”¶æ¬¾ç URL
   - æ”¶æ¬¾è´¦æˆ·åç§°
   - æ”¯ä»˜æç¤ºä¿¡æ¯
   - è®¢å•è¿‡æœŸæ—¶é—´

### 2. åˆ›å»ºä¼šå‘˜å¥—é¤

1. è¿›å…¥"å¥—é¤ç®¡ç†"æ ‡ç­¾
2. ç‚¹å‡»"æ·»åŠ å¥—é¤"
3. å¡«å†™å¥—é¤ä¿¡æ¯ï¼š
   - åç§°ï¼šå¦‚"æœˆåº¦ä¼šå‘˜"
   - ä»·æ ¼ï¼šå¦‚ 19.9
   - æ—¶é•¿ï¼š30å¤©
   - ç‰¹æƒåˆ—è¡¨ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰
4. å‹¾é€‰"ä¸Šæ¶é”€å”®"
5. ä¿å­˜

### 3. æµ‹è¯•å®Œæ•´æµç¨‹

å»ºè®®æŒ‰ä»¥ä¸‹é¡ºåºæµ‹è¯•ï¼š
1. åˆ›å»ºä¸€ä¸ªæµ‹è¯•å¥—é¤
2. å‰å°åˆ›å»ºè®¢å•ï¼ˆå¦‚æœæœ‰å‰å°è´­ä¹°é¡µé¢ï¼‰
3. ä¸Šä¼ æ”¯ä»˜å‡­è¯
4. åå°å®¡æ ¸è®¢å•
5. ç¡®è®¤ç”¨æˆ·è®¢é˜…å·²æ¿€æ´»

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æ—¥å¸¸ç»´æŠ¤

1. **å®šæœŸæ£€æŸ¥å¾…å®¡æ ¸è®¢å•**
   - å»ºè®®æ¯å¤©è‡³å°‘æ£€æŸ¥1-2æ¬¡
   - åŠæ—¶å¤„ç†ç”¨æˆ·æ”¯ä»˜è®¢å•

2. **å®šæœŸå¤‡ä»½æ•°æ®**
   ```bash
   # D1 æ•°æ®åº“å¤‡ä»½
   wrangler d1 export DB --output=backup.sql
   ```

3. **ç›‘æ§è®¢å•çŠ¶æ€**
   - å…³æ³¨è¿‡æœŸè®¢å•æ•°é‡
   - æ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸è®¢å•

### æ•…éšœæ’æŸ¥

**é—®é¢˜1ï¼šè®¢å•åˆ—è¡¨ä¸ºç©º**
```bash
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
# æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
# ç¡®è®¤è¡¨å·²æ­£ç¡®åˆ›å»º
```

**é—®é¢˜2ï¼šå®¡æ ¸è®¢å•åæ²¡æœ‰æ¿€æ´»è®¢é˜…**
```bash
# æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
# ç¡®è®¤ user_subscriptions è¡¨å­˜åœ¨
# éªŒè¯å¥—é¤IDæ˜¯å¦æ­£ç¡®
```

**é—®é¢˜3ï¼šæ”¯ä»˜å‡­è¯æ— æ³•æŸ¥çœ‹**
- ç¡®è®¤å›¾ç‰‡URLå¯è®¿é—®
- æ£€æŸ¥CORSè®¾ç½®
- å°è¯•ä½¿ç”¨Base64æ ¼å¼

## ğŸ”’ å®‰å…¨å»ºè®®

1. **ä¿æŠ¤ç®¡ç†åå°**
   - ä½¿ç”¨å¼ºå¯†ç 
   - å®šæœŸæ›´æ¢å¯†ç 
   - é™åˆ¶ç®¡ç†å‘˜æ•°é‡

2. **ä¿æŠ¤æ”¶æ¬¾ä¿¡æ¯**
   - æ”¶æ¬¾äºŒç»´ç å®šæœŸæ›´æ¢
   - ä¸è¦åœ¨å…¬å¼€åœºåˆæ³„éœ²

3. **å®¡æ ¸è®¢å•æ—¶æ³¨æ„**
   - ä»”ç»†æ ¸å¯¹æ”¯ä»˜å‡­è¯
   - æ£€æŸ¥é‡‘é¢æ˜¯å¦åŒ¹é…
   - æ³¨æ„å¯ç–‘è®¢å•

4. **æ•°æ®å¤‡ä»½**
   - å®šæœŸå¤‡ä»½æ•°æ®åº“
   - ä¿å­˜é‡è¦è®¢å•è®°å½•
   - ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶

## ğŸ“ ç›¸å…³æ–‡ä»¶

- `ä¼šå‘˜è®¢é˜…åŠŸèƒ½è¯´æ˜.md` - åŠŸèƒ½è¯´æ˜æ–‡æ¡£
- `database/*.sql` - æ•°æ®åº“è¡¨ç»“æ„
- `src/components/admin/` - ç®¡ç†ç»„ä»¶
- `src/app/api/admin/` - APIè·¯ç”±

## ğŸ’¡ æ¨èéƒ¨ç½²å¹³å°

æ ¹æ®æ‚¨çš„éœ€æ±‚é€‰æ‹©ï¼š

1. **Cloudflare Pages + D1**ï¼ˆæ¨èï¼‰
   - âœ… å…è´¹é¢åº¦å……è¶³
   - âœ… å…¨çƒCDNåŠ é€Ÿ
   - âœ… D1æ•°æ®åº“è‡ªå¸¦
   - âŒ éœ€è¦ç†Ÿæ‚‰Cloudflareç”Ÿæ€

2. **Vercel + Upstash Redis**
   - âœ… éƒ¨ç½²ç®€å•
   - âœ… è‡ªåŠ¨åŒ–CI/CD
   - âœ… å¼€å‘ä½“éªŒå¥½
   - âš ï¸ å…è´¹é¢åº¦æœ‰é™

3. **è‡ªå·±çš„æœåŠ¡å™¨**
   - âœ… å®Œå…¨æ§åˆ¶
   - âœ… ä¸å—é™åˆ¶
   - âœ… å¯è‡ªå®šä¹‰
   - âŒ éœ€è¦è¿ç»´èƒ½åŠ›

## ğŸ¯ ä¸‹ä¸€æ­¥

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨å¯ä»¥ï¼š

1. âœ… é…ç½®æ”¯ä»˜ä¿¡æ¯
2. âœ… åˆ›å»ºä¼šå‘˜å¥—é¤
3. âœ… æµ‹è¯•è´­ä¹°æµç¨‹
4. âœ… å¼€å§‹è¿è¥

---

**æœ€åæ›´æ–°ï¼š** 2026-01-22  
**ç‰ˆæœ¬ï¼š** v1.0  
**æ”¯æŒï¼š** å¦‚æœ‰é—®é¢˜è¯·æŸ¥çœ‹åŠŸèƒ½è¯´æ˜æ–‡æ¡£æˆ–æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—
